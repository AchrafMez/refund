FROM node:20-alpine

# Install system dependencies for Alpine
RUN apk add --no-cache bash openssl libc6-compat

WORKDIR /app

# Install dependencies
COPY package.json package-lock.json* ./
COPY prisma ./prisma/
RUN npm install

# Generate Prisma client
RUN npx prisma generate

# Copy source
COPY . .

# Expose ports
EXPOSE 3000
EXPOSE 5555

# Start with the entrypoint script (from mounted volume)
CMD ["sh", "./scripts/docker-entrypoint-dev.sh"]
